---
title: "Lab 3 -- Linear Regression"
format: html
editor: source
---

This is a lab to practice linear regressions and p values


```{r}
#| label: load-packages
#| include: false
library(tidyverse)
setwd('~/Documents/msu-eeb830831-quarto/')
palette <- c( "#FF5300", "#9ED80B", "#172869", "#43B629", "#8F92A1", "#1BB6AF")
```

![A diagram showing the accumulation of mutations between two individuals who share a common ancestor. The more time there is since these individual's most recent shared ancestor, the more time there is for mutations to accumulate between them. Figure is from [Graham Coop's population genetics notes](https://github.com/cooplab/popgen-notes/releases)](figs/Coal_two_lineages_muts.pdf){fig-alt="An upsidedown V with AGTTT at the top and, at the bottom, two sequences: ACTGT and AGGTT. Along the V, mutations are shown contributing to the differences between the bottom sequences" height=200%}


Population genetic theory suggests that population size should predict the amount of neutral genetic variation present within species. In a large population, individuals will be more distantly related to each other than individuals in a small population will be. The more distantly related individuals are to each other, the more time there has been for neutral mutations to accumulate between them. Therefore, in large populations, there will be more neutral genetic variation present between individuals. Because of this process, we expect to see a relationship between population size and neutral genetic variation when we look across species.

1. Download the data from [Vince Buffalo's github](https://github.com/vsbuffalo/paradox_variation/blob/master/data/combined_data.tsv). Use the code below to read in the data and then write code to remove individuals that are missing data for diversity and log10_popsize. You can use dplyr or base R to do this.

```{r}

myData <- read.table('data/buffalo_combined_data.tsv', sep="\t", header=T) #note the use of sep="\t" to parse the tab deliminated file  (Don't forget to set your working directory)

```

2.

Use lm() to fit a linear model with diversity as the response variable and log10_popsize as the explanatory variable. Look at the output of the model wiht summary(). Make a plot of the data with explanatory variable on the x axis and response variable on the y axis and plot your model fit line on top of the data.

```{r}
#code goes here

```

3.

Identify which species has the largest residual. Briefly write, in words, what this large residual means.

```{r}
#code goes here

```

4.

Make a plot with the explanatory variable on the x axis and the residuals for each individual on the y axis. Does the residual distribution seem to match the assumptions of a general linear model?

```{r, eval=F, echo=F}
ggplot(myResids, aes(x=log10_popsize, y=.resid)) + geom_point() +
theme_classic()+
  geom_hline(yintercept=0, linetype="dashed")

```

5.

Go back to the output of summary() for the model. What was the p value associated with the estimation of the effect size of your explanatory variable? Briefly describe below what this p value tells us about the effect size. (Bonus question: how does lm() calculate p values?)

6.

Pick an additional variable from the table that think might affect log10_diversity. Repeat the steps above to construct a linear model estimating the effect of that variable on genetic diversity.

