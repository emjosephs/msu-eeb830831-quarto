---
title: "Lab 3 -- Linear Regression"
format: html
editor: source
---

This is a lab to practice linear regressions and p values


```{r}
#| label: load-packages
#| include: false
library(tidyverse)
setwd('~/Documents/msu-eeb830831-quarto/')
palette <- c( "#FF5300", "#9ED80B", "#172869", "#43B629", "#8F92A1", "#1BB6AF")
```

![A diagram showing the accumulation of mutations between two individuals who share a common ancestor. The more time there is since these individual's most recent shared ancestor, the more time there is for mutations to accumulate between them. Figure is from [Graham Coop's population genetics notes](https://github.com/cooplab/popgen-notes/releases)](figs/Coal_two_lineages_muts.pdf){fig-alt="An upsidedown V with AGTTT at the top and, at the bottom, two sequences: ACTGT and AGGTT. Along the V, mutations are shown contributing to the differences between the bottom sequences" height=200%}


Population genetic theory suggests that population size should predict the amount of neutral genetic variation present within species. In a large population, individuals will be more distantly related to each other than individuals in a small population will be. The more distantly related individuals are to each other, the more time there has been for neutral mutations to accumulate between them. Therefore, in large populations, there will be more neutral genetic variation present between individuals. Because of this process, we expect to see a relationship between population size and neutral genetic variation when we look across species.

You can download this data from [Vince Buffalo's github](https://github.com/vsbuffalo/paradox_variation/blob/master/data/combined_data.tsv). Use the code below to read in the data.

```{r}

myData <- read.table('data/buffalo_combined_data.tsv', sep="\t", header=T) #note the use of sep="\t" to parse the tab deliminated file

```

First, remove individuals that are missing data for diversity and log10_popsize

```{r, echo=F, eval=F}
myData1 <- dplyr::filter(myData, !is.na(log10_popsize), !is.na(diversity))

```

Use lm() to do a linear model with diversity as the response variable and log10_popsize as the explanatory variable.

```{r, eval=F, echo=F}
model1 <- lm(diversity~log10_popsize,data=myData1)

summary(model1)

ggplot(myData1, aes(x=log10_popsize, y=diversity)) + geom_point() +
theme_classic() + 
geom_smooth(method='lm', formula= y~x)

```

Which species has the largest residual? Briefly write, in words, what this large residual means.

```{r,eval=F, echo=F}

library(broom)
myResids <- augment(model1) |> select(diversity, log10_popsize, .fitted, .resid)
myResids[which.max(abs(myResids$.resid)),]

myData1[which.max(abs(myResids$.resid)),]$species
```

Make and interpret a residual plot. Do you think the model is fitting well?

```{r, eval=F, echo=F}
ggplot(myResids, aes(x=log10_popsize, y=.resid)) + geom_point() +
theme_classic()+
  geom_hline(yintercept=0, linetype="dashed")

```

What is the pvalue? Walk through how it's calculated here.


Pick two additional variables from the table that you are interested in. Run the regression and look at the residuals.

